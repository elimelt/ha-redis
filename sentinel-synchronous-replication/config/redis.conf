# Redis Configuration for Synchronous Replication
# Based on https://antirez.com/news/58

# Network
bind 0.0.0.0
port 6379
protected-mode no

# General
daemonize no
pidfile /var/run/redis.pid
loglevel notice
logfile ""

# Databases
databases 16

# Memory
maxmemory 256mb
maxmemory-policy volatile-ttl
maxmemory-samples 10

# Persistence - DISABLED (fully in-memory)
save ""

# Append Only File - DISABLED (fully in-memory)
appendonly no

# Synchronous Replication Settings
# These settings implement the "min-replicas" approach from antirez's article
# Writes will be rejected if we don't have at least N replicas with lag < M seconds

# Require at least 1 replica to acknowledge writes
# This means writes need to reach master + 1 replica (2 nodes total)
min-replicas-to-write 1

# Maximum lag allowed for replicas (in seconds)
# Replicas with lag > 10 seconds won't count toward min-replicas-to-write
min-replicas-max-lag 10

# Replication settings
repl-diskless-sync yes
repl-diskless-sync-delay 5
repl-ping-replica-period 1
repl-timeout 60

# Client output buffer limits
client-output-buffer-limit normal 2mb 1mb 20
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 8mb 2mb 20

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128

